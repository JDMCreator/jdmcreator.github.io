<!doctype>
<html>
<title>GIF to CSS3 Generator for Reddit</title>
<style>
canvas{
position:absolute;
left:-9999px;
top:-9999px;
}
.error{
font-weight:bold;
color:red;
display:none;
}
@keyframes red{
from{
background:red;
}
to{
background:rgba(255,0,0,0);
}
}
.red{
animation:red 1s;
}
</style>
<script type="text/javascript" src="libgif.js"></script>
<script type="text/javascript">

function upload(element){
 var file    = element.files[0];
  var reader  = new FileReader();

  reader.onloadend = function () {
	var url =reader.result;
	var rub = new SuperGif({ gif: document.getElementById('img') })

	rub.load_url(url, function(){
		drawImage(rub)
	});
  }

  if (file) {
document.getElementById('show').style.display="none";
document.getElementById('loading').style.display="block";
    reader.readAsDataURL(file);
  }
  else{
document.getElementById('select_gif').className="red";
  }
}
function unbeautify(css, minimify){
css = css.replace(/;(\s*)}/g,"$1}").replace(/([^0-9])0\s*(?:px|pt|em|ex)/g,"$10");
if(minimify){
	css = css.replace(/[\n\t]+/g, "").replace(/\: */g, ":").replace(/ *(\}|\{)/g, "$1");
}
return css;
}
function drawImage(rub){
var canvas = document.getElementById('canvas'),
gifheight = rub.get_canvas().height,
gifwidth = rub.get_canvas().width,
img = document.getElementById('final_img'),
frames = rub.getFrames(),
totalTime = 0,
//hframes = Math.floor(Math.pow(frames.length, 0.5)),
//wframes = Math.ceil(frames.length/hframes);
hframes = frames.length,
wframes = 1;
var height = hframes * gifheight,
width = wframes * gifwidth;


canvas.width = width;
canvas.height = height;
if(document.getElementById('backward').checked){
	frames.reverse();
}
var line = 0,
col = -1;
for(var i=0, l = frames.length;i<l;i++){
var frame = frames[i];
col++;
if(col>=wframes){
col = 0;
line++;

}
	canvas.getContext('2d').putImageData(frame.data, col*gifwidth, gifheight*line, 0, 0, gifwidth, gifheight);
	totalTime += frame.delay;
}
img.removeAttribute("width");
img.removeAttribute("height");
if(height*frames.length>width){
img.height=100;
}
else{
img.width=100;
}
if(document.getElementById('jpeg').checked){
img.src = canvas.toDataURL("image/jpeg", 1);
}
else if(document.getElementById('jpeg_80').checked){
img.src = canvas.toDataURL("image/jpeg", 0.8);
}
else{
img.src = canvas.toDataURL();
}
var newimg = document.createElement("img");
newimg.id="img";
document.body.appendChild(newimg);
if(img.src.length<30){
	document.getElementById('loading').style.display="none";
	document.getElementById('err_too_big').style.display="block";
	return false;
}
info_img.innerHTML=(width)+"x"+(height)+"px - "+frames.length+" frames - "+size(img.src);

/*generate keyframes*/
var text="",
gif_name=document.getElementById('name').value,
actualTime=0;
img.setAttribute("download",gif_name);
text="@keyframes gif-"+gif_name+" {\n";
for(var i=0, l = frames.length;i<l;i++){
	var frame = frames[i];
	if(i<frames.length-1){
		text += "\t"+Math.round(actualTime/totalTime*10000)/100+"% {background-position:0px "+gifheight*-i+"px;}\n"
	}
	else{
		text += "\t"+Math.round(actualTime/totalTime*10000)/100+"%, 100% {background-position:0px -"+gifheight*i+"px;}"
	}
	actualTime += frame.delay;
}
text+="\n}\n"
text+="a[href=\"#gif-"+gif_name+"\"] {\n\tbackground:url(%%"+gif_name+"%%) no-repeat 0px 0px;\n\tdisplay:inline-block;\n\twidth:"+gifwidth+"px;\n\theight:"+gifheight+"px;"
text+="\n\tanimation: gif-"+gif_name+" "+(totalTime/100)+"s "+(document.getElementById('infinity').checked ? "infinite " : "")+"steps(1);\n\tfont-size:0px;\n\tcursor:default\n}";
text+="\na[href=\"#gif-"+gif_name+"\"]:active {\n\tpointer-events: none;\n}";
if(document.getElementById('pause_hover').checked){
	text+="\na[href=\"#gif-"+gif_name+"\"]:hover {\n\tanimation-play-state: paused;\n}";
}
//document.getElementById('css').value=unbeautify(text, !true);
document.getElementById('css').value=text;
document.getElementById('r_name').value = gif_name;
document.getElementById('markdown').value = "[](#gif-"+gif_name+")";
document.getElementById('loading').style.display="none";
document.getElementById('show').style.display="block";
}
function size(url){
url = url.substring(url.indexOf(',')+1);
var str = atob(url),
size = str.length;
if(size < 1000){
return size+" B";
}
else if(size < 1000000){
return (Math.round(size/10)/100)+" KB";
}
else if(size < 1000000000){
return (Math.round(size/10000)/100)+" MB"
}
else{
return (Math.round(size/10000000)/100)+" GB"
}
}
</script>
</html>
<span id="select_gif" onanimationend="this.className=''">Select your GIF : <input type="file" accept="image/gif" id="input"></span><br>
Select an ID for your GIF : <input id="name" value="MyGif"><br>
Options:
<blockquote>
<input type=checkbox id="backward"> Play GIF backward<br>
<input type=checkbox checked id="infinity"> Play infinitly<br>
<input type=checkbox id="pause_hover"> Pause on hover<br>
<input type=radio checked name="format" id="png"> PNG <input type=radio name="format" id="jpeg"> JPEG <input type=radio name="format" id="jpeg_80"> JPEG (80% Quality)
</blockquote>
<button onclick="upload(document.getElementById('input'))">Upload</button>
<div id="loading" style="display:none;">Loading...</div>
<br>
<canvas id="canvas"></canvas><img id="img" style="position:absolute;left:-9999px;top:-9999px;">
<div style="display:none" id="show">
<h2>Step #1 : Save the following PNG image (<span id="info_img"></span>)</h2>
<br>
<img height=100 id="final_img">
<p>Upload it on Reddit and name it <input type="text" readonly id="r_name">.</p>
<h2>Step #2 : Copy the following CSS in your subreddit stylesheet.</h2>
<textarea id="css" style="width:80%;height:400px;"></textarea>
<h2>Step #3 : Use this Markdown code to insert the gif in your sidebar, in posts or in comments</h2>
<textarea id="markdown" style="width:80%;height:100px;"></textarea>
</div>
<div class="error" id="err_too_big">Your browser don't support treatment of spritesheet that big. Try again with another browser.</div>
<hr>
<a href="http://jdmcreator.byethost5.com/lab/donate.html">Donate</a> | This generator use a fork of <a href="https://github.com/buzzfeed/libgif-js">libgif.js</a>
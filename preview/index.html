<!doctype>
<html>

<head>
<meta charset="UTF-8"> 
	<title>LaTeX Tables Editor</title>
	<style media="all" type="text/css">
		#table {
			font-family: "Computer Modern", sans-serif;
		}
		#create_table{
			border-collapse:separate;
			border-spacing:2px;
		}
		#create_table td{
			border:1px solid black;
			height:15px;
			width:15px;
		}
		#create_table td.selected{
			background:highlight;
		}
		#table td {
			margin: 0;
		}

		body[data-view-editor] #table {
			border-collapse: collapse !important;
			border-spacing:0px !important;
		}

		body:not([data-view-editor]) #table td {
			border: 1px dotted lightgrey;
		}

		#table .outer {
			padding-left: 3px;
			padding-right: 3px;
		}

		nav {
			font-family: Helvetica;
		}

		.group {
			display: inline-block;
			border: 1px solid black;
			border-radius: 5px;
			padding: 2px;
		}

		.group .button {
			display: inline-block;
			cursor: default;
			border: 1px solid black;
			border-radius: 3px;
			margin-top: 2px;
			margin-bottom: 2px;
			padding: 2px;
		}

		.group .button:hover:active,
		.group .button:active {
			background: lightgray;
		}

		.group .button.button-selected {
			background: darkgray;
			color: white;
		}

		.group .button.button-selected:active,
		.group .button.button-selected:hover:active {
			background: dimgray;
		}

		.group .button:not(.button-selected):hover {
			background: whitesmoke;
		}

		.group .button .button-legend {
			font-size: x-small;
		}

		.group-legend {
			font-size: smaller;
			text-align: center;
			border-top: 1px solid black;
			margin-left: 2px;
			margin-right: 2px;
		}

		#table td div[contenteditable] {
			min-height: 1em;
			min-width:1ex;
		}

		em em {
			font-style: normal;
		}

		body[data-border-editor] #table * {
			cursor: pointer !important;
		}

		body[data-view-editor] #table * {
			cursor: default !important;
		}
		td[data-two-diagonals] {
			position: relative;
		}

		td[data-two-diagonals]:before,
		td[data-two-diagonals]::before {
			content: "";
			position: absolute;
			top: 33%;
			left: 0;
			right: 0;
			bottom: 0;
			z-index: -1;
			background: linear-gradient(to right top, rgba(255, 255, 255, 0) 0%, rgba(255, 255, 255, 0) 49.9%, #000000 50%, #000000 51%, rgba(255, 255, 255, 0) 51.1%, rgba(255, 255, 255, 0) 100%);
		}

		td[data-two-diagonals]:after,
		td[data-two-diagonals]::after {
			content: "";
			position: absolute;
			top: 0;
			left: 33%;
			right: 0;
			bottom: 0;
			z-index: -1;
			background: linear-gradient(to right top, rgba(255, 255, 255, 0) 0%, rgba(255, 255, 255, 0) 49.9%, #000000 50%, #000000 51%, rgba(255, 255, 255, 0) 51.1%, rgba(255, 255, 255, 0) 100%);
		}

		td[data-two-diagonals] div[contenteditable]:not(:last-child) {
			display: inline-block;
		}

		td[data-align="l"] {
			text-align: left;
		}

		td[data-align="c"] {
			text-align: center;
		}

		td[data-align="r"] {
			text-align: right;
		}

		td[data-diagonal] {
			background: linear-gradient(to right top, rgba(255, 255, 255, 0) 0%, rgba(255, 255, 255, 0) 49.9%, #000000 50%, #000000 51%, rgba(255, 255, 255, 0) 51.1%, rgba(255, 255, 255, 0) 100%);
		}

		td[data-diagonal] div[contenteditable] {
			margin-right: 50%;
			text-align: left;
			word-break: keep-all;
			white-space: nowrap;
		}

		td[data-diagonal] div[contenteditable]:first-child {
			margin-left: 50%;
			margin-right: 0;
			text-align: right !important;
		}

		body:not([data-view-editor]) #table td[data-rotated]:not([data-selected]) div.outer {
			display: inline-block;
			overflow: hidden;
		}

		#popup_new {
			z-index: 9999;
			background: white;
			position: fixed;
			background: white;
			top: 5%;
			left: 5%;
			right: 5%;
			bottom: 5%;
			padding: 5px;
			border: 1px solid gray;
			text-align: center;
			display: none;
		}


		#right {
			position: fixed;
			top: 0;
			right: 0;
			margin:0;
			padding:0;
			background:#ddd;
			bottom:0;
		}

		#properties,
		#borders {
			margin: 5px;
			background: whitesmoke;
			padding: 5px;
			border-radius:10px;
		}

		#properties h3,
		#borders h3 {
			margin: 0;
			border-bottom: 1px solid gray;
			text-align: center;
		}

		#properties h6,
		#borders h6 {
			margin: 0;
			padding-top: 2px;
			padding-bottom: 2px;
			margin-top: 3px;
			margin-bottom: 3px;
			border-top: 1px solid gray;
			border-bottom: 1px solid gray;
		}

		#latex_content {
			width: 100%;
		}

		#table tr[data-border-top="toprule"] td,
		#table td[data-border-top="toprule"] {
			padding-top: 0.65ex !important;
		}

		#table[data-booktabs] tr:first-child td {
			padding-top: 0.65ex !important;
			border-top: 2px solid black !important;
		}

		#table[data-booktabs] tr:last-child td {
			padding-bottom: 0.4ex;
			border-bottom: 2px solid black !important;
		}

		#table tr[data-border-bottom="midrule"] td,
		#table td[data-border-bottom="midrule"] {
			padding-bottom: 0.4ex;
		}

		#table tr[data-border-bottom="hline"] td,
		#table td[data-border-bottom="hline"] {
			//border-bottom:0.4pt solid black;
		}

		#table tr[data-border-bottom="bottomrule"] td,
		#table td[data-border-bottom="bottomrule"] {
			padding-bottom: 0.4ex; //border-bottom:0.08em solid black;
		}

		#table td[data-rotated]:not([data-selected]) div[contenteditable],
		body[data-view-editor] #table td[data-rotated] div[contenteditable] {
			display: inline-block;
			white-space: nowrap;
			transform: translate(0, 100%) rotate(-90deg);
			transform-origin: 0 0;
		}

		body:not([data-view-editor]) #table td[data-selected][data-diagonal] {
			background: linear-gradient(to right top, highlight 0%, highlight 49.9%, #000000 50%, #000000 51%, highlight 51.1%, highlight 100%);
		}

		body:not([data-view-editor]) #table td[data-selected][data-two-diagonals] div.outer {
			position: relative;
		}

		body:not([data-view-editor]) #table td[data-selected][data-two-diagonals] div.outer:before {
			content: "";
			position: absolute;
			background: highlight;
			z-index: -2;
			left: 0;
			bottom: 0;
			top: 0;
			right: 0;
		}

		#table td,
		#table tr,
		#table {
			margin: 0;
			padding: 0;
		}

		body:not([data-view-editor]) #table td[data-selected]:not([data-two-diagonals]):not([data-diagonal]) {
			background: highlight;
		}
	</style>
	<link href="css/bootstrap.min.css" rel="stylesheet">
	<script type="text/javascript" src="js/jquery.min.js">
	</script>
	<script type="text/javascript" src="js/bootstrap.min.js">
	</script>
	<script type="text/javascript" src="table.js">
	</script>
	<script type="text/javascript">
		function $id(id) {
			return document.getElementById(id);
		}
		(function() {
			"use strict"
			var sameHeader = function(cellHeader, colHeader, rowN) {
					if (rowN !== 0) {
						colHeader = (/[a-z].*/i.exec(colHeader) || ["l"])[0];
					}
					return cellHeader == colHeader
				},
				table = new(function() {
					this.create = function(cols, rows) {
						rows = parseInt(rows, 10);
						cols = parseInt(cols, 10);
						var fr = document.createDocumentFragment();
						for (var i = 0; i < rows; i++) {
							fr.appendChild(this.createRow(cols));
						}
						this.element.innerHTML = "";
						this.element.appendChild(fr);
					};
					this.removeAllSelection = function() {
						this.selectedCell = null;
						var allSelected = document.querySelectorAll("#table td[data-selected]");
						for (var i = 0, l = allSelected.length; i < l; i++) {
							allSelected[i].removeAttribute("data-selected");
						}
					}
					this.forEachSelectedCell = function(fn) {
						var allCells = document.querySelectorAll("#table td[data-selected]");
						for (var i = 0, l = allCells.length; i < l; i++) {
							if (fn(allCells[i], i) === false) {
								break;
							}
						}
					}
					this.separators = function(hm) {
						if (hm == 2) {
							this.twoDiagonals();
						} else if (hm == 1) {
							this.diagonal();
						} else {
							this.forEachSelectedCell(function(cell) {
								if (cell.hasAttribute("data-two-diagonals")) {
									var toDel = cell.querySelector("div[contenteditable]");
									cell.setAttribute("data-two-diagonals-data", toDel.innerHTML);
									toDel.parentElement.removeChild(toDel);
								}
								if (cell.hasAttribute("data-two-diagonals") || cell.hasAttribute("data-diagonal")) {
									var toDel = cell.querySelector("div[contenteditable]:last-child");
									cell.setAttribute("data-diagonal-data", toDel.innerHTML);
									toDel.parentElement.removeChild(toDel);
								}
								cell.removeAttribute("data-two-diagonals");
								cell.removeAttribute("data-diagonal");
							});
						}
					}
					this.interpreters = {};
					this.createInterpreter = function(format, fn) {
						this.interpreters[format] = fn;
					}
					this.interpret = function(format) {
						document.getElementById('c')
							.value = this.interpreters[format].call(this);
					}
					this.insertRowUnder = function(cell) {
						cell = cell || this.selectedCell;
						if (!cell) {
							return false;
						}
						var position = this.Table.position(cell),
							y = -1;
						if (position) {
							y = position.y + cell.rowSpan;
						}
						var _this = this;
						this.Table.insertRow(y, function(cell) {
							_this.applyToCell(cell)
						});
					}
					this.insertRowOver = function(cell) {
						cell = cell || this.selectedCell;
						if (!cell) {
							return false;
						}
						var position = this.Table.position(cell),
							y = 0;
						if (position) {
							y = Math.max(position.y, 0);
						}
						var _this = this;
						this.Table.insertRow(y, function(cell) {
							_this.applyToCell(cell)
						});
					}
					this.insertColBefore = function(cell) {
						cell = cell || this.selectedCell;
						if (!cell) {
							return false;
						}
						var position = this.Table.position(cell),
							x = 0;
						if (position) {
							x = Math.max(position.x, 0);
						}
						var _this = this;
						this.Table.insertCol(x, function(cell) {
							_this.applyToCell(cell)
						});
					}
					this.insertColAfter = function(cell) {
						cell = cell || this.selectedCell;
						if (!cell) {
							return false;
						}
						var position = this.Table.position(cell),
							x = 0;
						if (position) {
							x = position.x + cell.colSpan;
						}
						var _this = this;
						this.Table.insertCol(x, function(cell) {
							_this.applyToCell(cell)
						});
					}
					this.split = function() {
						var _this = this;
						this.Table.split(document.querySelectorAll("#table td[data-selected]"), function(cell) {
							_this.applyToCell(cell)
						});
					}
					this.createCellLike = function(cell) {
						var td = this.createCell();
						td.rowSpan = cell.rowSpan;
						td.colSpan = cell.colSpan;
						for (var i in cell.dataset) {
							td.dataset[i] = cell.dataset[i];
						}
						td.removeAttribute("data-selected");
						return td;
					}
					this.diagonal = function() {
						this.updateLaTeXInfoCell();
						this.forEachSelectedCell(function(cell) {
							if (!cell.hasAttribute("data-diagonal")) {
								if (cell.hasAttribute("data-two-diagonals")) {
									var toDel = cell.querySelector("div[contenteditable]");
									cell.setAttribute("data-two-diagonals-data", toDel.innerHTML);
									toDel.parentElement.removeChild(toDel);
									cell.removeAttribute("data-two-diagonals");
								} else {
									cell.querySelector(".outer")
										.innerHTML += "<div contenteditable>" + (cell.getAttribute("data-diagonal-data") || "[TEXT UNDER]") +
										"</div>";
								}
								cell.setAttribute("data-diagonal", "data-diagonal")
							}
						});
					}
					this.twoDiagonals = function() {
						this.updateLaTeXInfoCell();
						this.forEachSelectedCell(function(cell) {
							if (!cell.hasAttribute("data-two-diagonals")) {
								var div = cell.querySelector(".outer");
								if (cell.hasAttribute("data-diagonal")) {
									cell.removeAttribute("data-diagonal");
									div.innerHTML = "<div contenteditable>" + (cell.getAttribute("data-two-diagonals-data") || "[1]") +
										"</div>" + div.innerHTML;
								} else {
									div.innerHTML = "<div contenteditable>" + (cell.getAttribute("data-two-diagonals-data") || "[1]") +
										"</div>" + div.innerHTML + "<div contenteditable>" + (cell.getAttribute("data-diagonal-data") ||
											"[3]") + "</div>";
								}
								cell.setAttribute("data-two-diagonals", "data-two-diagonals");
							}
						});
					}
					this.rotate = function(state) {
						this.forEachSelectedCell(function(cell) {
							if (state) {
								cell.setAttribute("data-rotated", "data-rotated");
							}
							else{
								cell.removeAttribute("data-rotated");
							}
						});
						this.updateLaTeXInfoCell();
					}
					this.selectedCell = null;
					this.merge = function() {
						var _this = this;
						this.Table.merge(document.querySelectorAll("#table td[data-selected]"), function(colspan, rowspan, keep, removed) {
							var html = _this.getHTML(keep);
							for (var i = 0; i < removed.length; i++) {
								html += " " + _this.getHTML(removed[i])
							}
							_this.setHTML(keep, html);
						});
					}
					this.getCellPosition = function(_cell) {
						var table = this.element,
							occupied = [],
							rows = table.rows;
						for (var i = 0; i < rows.length; i++) {
							occupied.push([]);
						}
						for (var i = 0; i < rows.length; i++) {
							var cols = rows[i].cells,
								realcount = 0;
							for (var j = 0; j < cols.length; j++) {
								var cell = cols[j];
								if (occupied[i][realcount]) {
									j--;
									realcount++;
									continue;
								}
								if (cell == _cell) {
									return {
										x: i,
										y: realcount
									}
								}
								for (var h = 1; h < cell.rowSpan; h++) {
									for (var g = 0; g < cell.colSpan; g++) {
										occupied[i + h][realcount + g] = true;
									}
								}
								realcount += cell.colSpan;
							}
						}

					}
					this.getCellByPosition = function(x, y) {
						var table = this.element,
							occupied = [],
							rows = table.rows;
						if (x >= rows.length) {
							return null;
						}
						for (var i = 0; i < rows.length; i++) {
							occupied.push([]);
						}
						for (var i = 0, l = Math.min(rows.length, x + 1); i < l; i++) {
							var cols = rows[i].cells,
								realcount = 0;
							for (var j = 0; j < cols.length; j++) {
								var cell = cols[j];
								if (occupied[i][realcount]) {
									j--;
									realcount++;
									continue;
								}
								if (i == x && realcount == y) {
									return cell;
								}
								for (var h = 1; h < cell.rowSpan; h++) {
									for (var g = 0; g < cell.colSpan; g++) {
										occupied[i + h][realcount + g] = true;
									}
								}
								realcount += cell.colSpan;
							}
						}
					};
					this.unselectCells = function(group) {
						for (var i = 0; i < group.length; i++) {
							group.removeAttribute("data-selected");
						}
					}
					this.setMargin = function(left, value) {
						this.forEachSelectedCell(function(cell) {
							if (left) {
								cell.setAttribute("data-margin-left", value);
							} else {
								cell.setAttribute("data-margin-right", value);
							}
						});
					}
					this.setAlign = function(value) {
						if (value != "l" && value != "r" && value != "c") {
							value = "l";
						}
						$id("info_align_left").classList.remove("active");
						$id("info_align_center").classList.remove("active");
						$id("info_align_right").classList.remove("active");
						this.forEachSelectedCell(function(cell) {
							cell.setAttribute("data-align", value);
						});
						$id({
							"l" : "info_align_left",
							"c" : "info_align_center",
							"r" : "info_align_right"
						}[value]).classList.add("active");
					}

					this.updateLaTeXInfoCell = function(cell) {
						cell = cell || this.selectedCell;
						if (cell) {
							document.querySelector("#latex_content")
								.value = this.generateForCell(cell);
						}
					}
					this.getHTML = function(cell) {
						return cell.querySelector("div[contenteditable]")
							.innerHTML;
					}
					this.setHTML = function(cell, HTML) {
						cell.querySelector("div[contenteditable]")
							.innerHTML = HTML;
					}
					this.cellBefore = function(cell) {
						return cell.previousSibling;
					}
					this.blacklistPackages = {};
					this.isSelected = function(cell) {
						return cell.hasAttribute("data-selected");
					}
					this.selectCell = function(element, CTRL, SHIFT) {
						if (!CTRL) {
							this.removeAllSelection();
							this.showInfo(element);
							this.selectedCell = element;
						}
						if (SHIFT && false) {//TODO
							var actualSelected = document.querySelector("#table td[data-selected]");
						} else {
							if(CTRL && element.hasAttribute("data-selected")){
								element.removeAttribute("data-selected");
							}
							else{
								element.setAttribute("data-selected", "data-selected");
							}
						}
					}
					this._id = function(id) {
						return document.getElementById(id)
					}
					this.showInfo = function(element) {
						document.querySelector("#latex_content")
							.value = this.generateForCell(element);
						this._id("info_separators")
							.value = element.hasAttribute("data-two-diagonals") ? 2 : element.hasAttribute("data-diagonal") ? 1 : 0;
						this._id("info_align_left").classList.remove("active");
						this._id("info_align_center").classList.remove("active");
						this._id("info_align_right").classList.remove("active");
						var align = element.getAttribute("data-align");
						if(align == "c"){
							this._id("info_align_center").classList.add("active");
						}
						else if(align == "r"){
							this._id("info_align_right").classList.add("active");
						}
						else{
							this._id("info_align_left").classList.add("active");
						}
						this._id("info_rotated").checked = element.hasAttribute("data-rotated");
					}
					this.applyToCell = function(td) {

						var div1 = document.createElement("div");
						div1.className = "outer";
						var div2 = document.createElement("div");
						div2.contentEditable = true;
						div2.innerHTML = "";
						div2.addEventListener("input", function() {
							if (table.selectedCell === (this.parentElement || {})
								.parentElement) {
								table.updateLaTeXInfoCell();
							}
						}, false);
						div1.appendChild(div2);
						td.appendChild(div1);
						td.addEventListener("click", this._clickCellManager, false);
						return td;
					}
					this.split = function(){
						this.Table.split(document.querySelector("#table td[data-selected]"), this.applyToCell);
					}
					this.createCell = function(classNames) {
						var td = document.createElement("td");
						td.classNames = classNames || "";
						return this.applyToCell(td);
					}
					this.createRow = function(cols, classNames) {
						var tr = document.createElement("tr");
						for (var i = 0; i < cols; i++) {
							tr.appendChild(this.createCell(classNames));
						}
						return tr;
					}
					this.undo = function(){
						// A better undo manager is on the way;
						if(document.queryCommandEnabled("undo")){
							document.execCommand("undo");
						}
					}
					this.selectionAllowed = true;
					this.hasShownBorderEditorInfo = false;
					this.mode = function(n) {
						if (arguments.length == 0) {
							if (document.body.hasAttribute("data-view-editor")) {
								return 1
							}
							if (document.body.hasAttribute("data-border-editor")) {
								return 2
							}
							return 0;
						} else {
							$id("button-mode-edit")
								.classList.remove("active");
							$id("button-mode-border")
								.classList.remove("active");
							$id("button-mode-view")
								.classList.remove("active");
							// Set
							if (n == 1 || n == 2) {
								var l = this.element.querySelectorAll("div[contenteditable]");
								for (var i = 0; i < l.length; i++) {
									(l[i] || {})
									.contentEditable = false;
								}
								this.selectionAllowed = false;
								if (n == 1) {
									// View
									document.body.removeAttribute("data-border-editor")
									document.body.setAttribute("data-view-editor", "data-view-editor");
									$id("button-mode-view")
										.classList.add("active");
								} else {
									// Border
									if(!this.hasShownBorderEditorInfo){
										this.hasShownBorderEditorInfo = true;
										$("#border-editor-info").show(100);
									}
									document.body.removeAttribute("data-view-editor");
									document.body.setAttribute("data-border-editor", "data-border-editor");
									$id("button-mode-border")
										.classList.add("active");
								}
							} else {
								// Edit
								document.body.removeAttribute("data-view-editor")
								document.body.removeAttribute("data-border-editor")
								this.selectionAllowed = true;
								var l = this.element.querySelectorAll("div[contenteditable]");
								for (var i = 0; i < l.length; i++) {
									(l[i] || {})
									.contentEditable = true
								}
								$id("button-mode-edit")
									.classList.add("active");
							}
						}
					}
					this.log = "";
					this.message = function(text, type){
						this.log+=text+"\n---------------\n";
					}
					this.importFromJSON = function(o){
						if(o.autoBooktabs){
							document.body.setAttribute("data-booktabs", "data-booktabs");
							$id("button-booktabs").classList.add("active");
						}
						else{
							document.body.removeAttribute("data-booktabs");
							$id("button-booktabs").classList.remove("active");
						}
						if(o.caption){
							if(o.caption.numbered){
								$id("caption-nb").value="*";
							}
							$id("caption").value = o.caption.caption;
							$id("label").value = o.caption.label;
						}
						var table = document.createDocumentFragment();
						for(var i=0;i<o.cells.length;i++){
							var row = o.cells[i],
							elem = document.createElement("tr");
							for(var j=0;j<row.length;j++){
								var cellO = row[j];
								var cell = document.createElement("td");
								cell = this.applyToCell(cell);
								this.setHTML(cell, cellO.html);
								for(var k in cellO.dataset){
									if(cellO.dataset.hasOwnProperty(k)){
										cell.dataset[k] = cellO.dataset[k];
									}
								}
								if("rowSpan" in cellO && cellO.rowSpan > 1){
									cell.rowSpan = cellO.rowSpan;
								}
								if(cellO.colSpan && cellO.colSpan > 1){
									cell.colSpan = cellO.colSpan;
								}
								if(cellO.css){
									cell.style.cssText = cellO.css;
								}
								elem.appendChild(cell);
							}
							table.appendChild(elem);
						}
						while(this.element.firstChild){
							this.element.removeChild(this.element.firstChild);
						}
						this.element.appendChild(table);
					}
					this.exportToJSON = function() {
						var o = {},
							table = this.element;
						o.autoBooktabs = table.hasAttribute("data-booktabs");
						o.caption = this.caption();
						o.cells = []
						for (var i = 0; i < table.rows.length; i++) {
							var cells = table.rows[i].cells;
							o.cells.push([]);
							for (var j = 0; j < cells.length; j++) {
								var cell = cells[j],
									cellO = {};
								cellO.html = this.getHTML(cell);
								cellO.dataset = cell.dataset;
								if (cellO.dataset.selected) {
									delete cellO.dataset.selected;
								}
								cellO.css = cell.style.cssText;
								cellO.rowSpan = cell.rowSpan;
								cellO.colSpan = cell.colSpan;
								o.cells[o.cells.length - 1].push(cellO);
							}
						}
						return o;
					}
					this.saveToJSON = function(){
						var o = this.exportToJSON();
						document.getElementById('c').value = JSON.stringify(o, null, "    ");
					}
					this.autoBooktabs = function() {
						var table = this.element;
						if (table.hasAttribute("data-booktabs")) {
							table.removeAttribute("data-booktabs");
							$id('button-booktabs')
								.className = "btn btn-default";
						} else {
							table.setAttribute("data-booktabs", "data-booktabs");
							$id('button-booktabs')
								.className = "btn btn-default active";
						}
					}
					this._clickCellManager = function(event) {
						if (table.selectionAllowed) {
							table.selectCell(this, event.ctrlKey, event.shiftKey);
						} else if (document.body.hasAttribute("data-border-editor")) {
							table.editBorder(this, event.pageX || event.clientX + document.body.scrollLeft + document.documentElement.scrollLeft,
								event.pageY || event.clientY + document.body.scrollTop + document.documentElement.scrollTop);
						}
					}
					this.setBorder = function(element, pos, border, css) {
						var pos2 = pos.toLowerCase();
						if (element.getAttribute("data-border-" + pos2) == border) {
							element.removeAttribute("data-border-" + pos2);
							element.style["border" + pos] = "";
						} else {
							element.setAttribute("data-border-" + pos2, border);
							element.style["border" + pos] = css;
						}
					}
					this.setAllBorders = function() {
						var borderType = document.getElementById('border')
							.value,
							border = "1px solid black";
						if (borderType == "toprule" || borderType == "bottomrule") {
							border = "2px solid black";
						} else if (borderType == "double") {
							border = "2px double black";
						} else if (borderType == "hdashline") {
							border = "1px dashed black";
						} else if (borderType == "dottedline") {
							border = "1px dotted black";
						}
						this.forEachSelectedCell(function(cell) {
							var style = cell.style;
							style.borderTop = style.borderLeft = style.borderRight = style.borderBottom = border;
							cell.setAttribute("data-border-top", borderType);
							cell.setAttribute("data-border-left", borderType);
							cell.setAttribute("data-border-right", borderType);
							cell.setAttribute("data-border-bottom", borderType);
						});
					}
					this.removeBorders = function() {
						this.forEachSelectedCell(function(cell) {
							var style = cell.style;
							style.borderTop = style.borderLeft = style.borderRight = style.borderBottom = "";
							cell.removeAttribute("data-border-top");
							cell.removeAttribute("data-border-left");
							cell.removeAttribute("data-border-right");
							cell.removeAttribute("data-border-bottom");
						});
					}
					this._absolutePosition = function(el) {
						// Stolen from here : https://stackoverflow.com/a/32623832/8022172
						var	found,
							left = 0,
							top = 0,
							width = 0,
							height = 0,
							offsetBase = this._absolutePosition.offsetBase;
						if (!offsetBase && document.body) {
							offsetBase = this._absolutePosition.offsetBase = document.createElement('div');
							offsetBase.style.cssText = 'position:absolute;left:0;top:0';
							document.body.appendChild(offsetBase);
						}
						if (el && el.ownerDocument === document && 'getBoundingClientRect' in el && offsetBase) {
							var boundingRect = el.getBoundingClientRect();
							var baseRect = offsetBase.getBoundingClientRect();
							found = true;
							left = boundingRect.left - baseRect.left;
							top = boundingRect.top - baseRect.top;
							width = boundingRect.right - boundingRect.left;
							height = boundingRect.bottom - boundingRect.top;
						}
						return {
							found: found,
							left: left,
							top: top,
							width: width,
							height: height,
							right: left + width,
							bottom: top + height
						};
					}
					this.editBorder = function(element, x, y) {
						var pos = this._absolutePosition(element),
							borderType = document.getElementById('border')
							.value,
							border = "1px solid black";
						if (borderType == "toprule" || borderType == "bottomrule") {
							border = "2px solid black";
						} else if (borderType == "double") {
							border = "2px double black";
						} else if (borderType == "hdashline") {
							border = "1px dashed black";
						} else if (borderType == "dottedline") {
							border = "1px dotted black";
						}
						if (y - pos.top < 4) {
							this.setBorder(element, "Top", borderType, border);
						} else if (pos.bottom - y < 4) {
							this.setBorder(element, "Bottom", borderType, border);
						} else if (x - pos.left < 4) {
							this.setBorder(element, "Left", borderType, border);
						} else if (pos.right - x < 4) {
							this.setBorder(element, "Right", borderType, border);
						}
					}
					this.loaded = false;
					this.element = null;
					this.load = function(table) {
						this.loaded = true;
						this.element = table;
						document.execCommand("styleWithCSS", false, false);
						document.execCommand("insertBrOnReturn", false, false);
						this.Table = new Table(table);
					}
					this.generateFromHTML = function(html, ignoreMultiline) {
						//ToDo : improve backslash
						html = html.replace(/\\/g, "\\textbackslash ")
							.replace(/(\$|\%|\{|\}|\~|\#)/ig, "\\$1");
						html = html.replace(/&nbsp;/g, "~")
							.replace(/\&/g, "\\&")
							.replace(/<br[/\s]*>/ig, " \\\\ ");
						html = html.replace(/<(b|(strong))((\s+[^>]*)|)>/ig, "\\textbf{")
							.replace(/<(i|(em))[^>]*>/ig, "\\textit{")
							.replace(/<\s*\/\s*(b|(strong)|(em)|i)[^>]*>/ig, "}");
						html = html.replace(/(<((div)|p))/ig, " \\\\ $1")
							.replace(/(\[|\])/ig, "{$1}");
						var div = document.createElement("div");
						div.innerHTML = html;
						var text = div.innerText || div.textContent;
						text = text.replace(/[ ]{2,}/g, " ")
							.replace(/[\n\r]+/g, "");
						if (text.indexOf("\\\\") >= 0 && !ignoreMultiline) {
							text = "\\begin{tabular}[c]{@{}l@{}}" + text + "\\end{tabular}";
						}
						return text
					};
					this.createCellObject = function(before, cell, after) {
						if (arguments.length == 2) {
							var content = before,
								o = {
									refCell: cell
								};
							if (content === false) {
								o.ignore = true;
							} else {
								o.content = o.fullContent = content;
							}
							return o;
						}
						var o = {
							cell: cell,
							ignore: false,
							before: before,
							after: after,
							leftBorder: cell.getAttribute("data-border-left") || "",
							rightBorder: cell.getAttribute("data-border-right") || "",
							content: this.generateForCell(cell),
							header: this.getHeaderForCell(cell),
							align: cell.getAttribute("data-align") || "l"
						}
							o.fullContent = before + "" + o.content + "" + after;
						return o;
					}
					this.generateForCell = function(cell) {
						var text = "";
						if (cell.hasAttribute("data-two-diagonals")) {
							var ce = cell.querySelectorAll("div[contenteditable]");
							this.packages["diagbox"] = true;
							text = "\\diagbox{" + this.generateFromHTML(ce[2].innerHTML) + "}{" + this.generateFromHTML(ce[0].innerHTML) + "}{" +
								this.generateFromHTML(ce[1].innerHTML) + "}"
						} else if (cell.hasAttribute("data-diagonal")) {
							var ce = cell.querySelectorAll("div[contenteditable]");
							if (this.blacklistPackages["diagbox"]) {
								this.packages["slashbox"] = true;
							} else {
								this.packages["diagbox"] = true;
							}
							text = "\\backslashbox{" + this.generateFromHTML(ce[0].innerHTML) + "}{" + this.generateFromHTML(ce[1].innerHTML) + "}";
						} else if (cell.hasAttribute("data-rotated")) {
							if (cell.rowSpan > 1) {
								if (this.blacklistPackages["makecell"]) {
									var inside = this.generateFromHTML(cell.querySelector("div[contenteditable]")
										.innerHTML, true)
									if (this.blacklistPackages["tabularx"]) {
										this.message("You may have to adjust the following value in one of your rotated cell : \""+(cell.rowSpan-0.2)+"\\normalbaselineskip\"");
										text = "\\begin{sideways}\\begin{tabular}{@{}p{" + (cell.rowSpan - 0.2) + "\\normalbaselineskip}@{}}" +
											inside + "\\end{tabular}\\end{sideways}";
										this.packages["rotating"] = true;
									} else {
										this.message("You may have to adjust the following value in one of your rotated cell : \""+(cell.rowSpan)+"\\normalbaselineskip\"");
										text = "\\begin{sideways}\\begin{tabularx}{" + cell.rowSpan + "\\normalbaselineskip}{X}" + inside +
											"\\end{tabularx}\\end{sideways}";
										this.packages["rotating"] = this.packages["tabularx"] = true;
									}
								} else {
									text = "\\rotcell{" + this.generateFromHTML(cell.querySelector("div[contenteditable]")
										.innerHTML) + "}"
									this.packages["makecell"] = true;
								}
							} else {
								if (this.blacklistPackages["rotating"]) {
									text = "\\rotcell{" + this.generateFromHTML(cell.querySelector("div[contenteditable]")
										.innerHTML) + "}"
									this.packages["makecell"] = true;
								} else {
									text = "\\begin{sideways}" + this.generateFromHTML(cell.querySelector("div[contenteditable]")
										.innerHTML) + "\\end{sideways}"
									this.packages["rotating"] = true;
								}
							}
						} else if (cell.rowSpan > 1 && !this.blacklistPackages["makecell"]) {
							text = "\\makecell{" + this.generateFromHTML(cell.querySelector("div[contenteditable]")
								.innerHTML, true) + "}";
							this.packages["makecell"] = true;
						} else {
							text = this.generateFromHTML(cell.querySelector("div[contenteditable]")
								.innerHTML);
						}
						return text;
					}
					this.packages = {};
					this.getHeaderForCell = function(cell) {
						var align = cell.getAttribute("data-align") || "l",
							leftBorder = cell.getAttribute("data-border-left") || "",
							rightBorder = cell.getAttribute("data-border-right") || "",
							o = {
								"": "",
								"normal": "|",
								"double": "||",
								"toprule": "!{\\vrule width \\heavyrulewidth}",
								"midrule": "!{\\vrule width \\lightrulewidth}",
								"bottomrule": "!{\\vrule width \\heavyrulewidth}",
								"hdashline": ":",
								"dottedline": ";{1pt/1pt}"
							}
						leftBorder = o[leftBorder] || "";
						rightBorder = o[rightBorder] || "";
						return leftBorder + align + rightBorder
					}
					this.getSimiliHeaderForCell = function(cell) {
						var align = cell.getAttribute("data-align") || "l",
							leftBorder = cell.getAttribute("data-border-left") || "",
							rightBorder = cell.getAttribute("data-border-right") || "",
							o = {
								"": "",
								"normal": "|",
								"double": "=",
								"toprule": "^",
								"midrule": "#",
								"bottomrule": "_",
								"hdashline": ":",
								"dottedline": ";"
							}
						leftBorder = o[leftBorder] || "";
						rightBorder = o[rightBorder] || "";
						return leftBorder + align + rightBorder
					}
					this.convertToHeader = function(simili) {
						var _this = this;
						return simili.replace(/[|=\^\#_;:]+/g, function(a) {
							var c = a.charAt(0);
							if (c == ":" || c == ";") {
								_this.packages["arydshln"] = true;
							}
							return {
								"|": "|",
								"^": "!{\\vrule width \\heavyrulewidth}",
								"=": "||",
								"#": "!{\\vrule width \\heavyrulewidth}",
								"_": "!{\\vrule width \\lightrulewidth}",
								":": ":",
								";": ";{1pt/1pt}"
							}[c] || ""
						});
					}
					this.getMatrixOfCells = function() {

						var table = this.element,
							rg = [],
							maxCols = 0,
							rows = table.rows;
						for (var i = 0; i < rows.length; i++) {
							rg.push([]);
						}
						for (var i = 0; i < rows.length; i++) {
							var row = rows[i],
								realCol = 0;
							for (var j = 0; j < row.cells.length; j++) {
								var cell = row.cells[j],
									cellHeader = this.getHeaderForCell(cell);
								if (typeof rg[i][realCol] != "object" && rg[i][realCol] !== false) {
									if (!cell.rowSpan || cell.rowSpan < 2) {
										if (!cell.colSpan || cell.colSpan < 2) {
											rg[i][realCol] = this.createCellObject("", cell, "");
										} else {
											var o = rg[i][realCol] = this.createCellObject("\\multicolumn{" + cell.colSpan + "}{" + cellHeader +
												"}{", cell, "}");
											for (var k = 1; k < cell.colSpan; k++) {
												rg[i][realCol + k] = this.createCellObject(false, o);
											}
										}
									} else {
										this.packages["multirow"] = true;
										var o;
										if (!cell.colSpan || cell.colSpan < 2) {
											o = rg[i][realCol] = this.createCellObject("\\multirow{" + cell.rowSpan + "}{*}{", cell, "}");
										} else {
											o = rg[i][realCol] = this.createCellObject("\\multicolumn{" + cell.colSpan + "}{" + cellHeader +
												"}{\\multirow{" + cell.rowSpan + "}{*}{", cell, "}}");
										}
										for (var k = 0; k < cell.rowSpan; k++) {
											for (var l = 0; l < cell.colSpan; l++) {
												// I hate four-level loops
												if (l == 0 && k != 0) {
													if (cell.colSpan > 1) {
														rg[i + k][realCol] = this.createCellObject("\\multicolumn{" + cell.colSpan + "}{" +
															cellHeader + "}{}", o);
													} else {
														rg[i + k][realCol] = this.createCellObject("", o)
													}
												} else if (l != 0 || k != 0) {
													rg[i + k][realCol + l] = this.createCellObject(false, o);
												}
											}
										}
									}
								} else {
									j--;
								}
								realCol++;
							}
						}
						return rg;
					}
					this.buildBlacklist = function(){
						var o = {}, check = document.querySelectorAll("input[type=checkbox][id^=blacklist]");
						for(var i=0;i<check.length;i++){
							if(!check[i].checked){
								o[check[i].value] = true;
							}
						}
						this.blacklistPackages = o;
					}
					this.removeRow = function(){
						if(this.selectedCell){
							this.Table.removeRow(this.selectedCell.parentElement.rowIndex);
						}
					}
					this.removeCol = function(){
						if(this.selectedCell){
							this.Table.removeCol(this.Table.position(this.selectedCell).x);
						}
					}
					this.getContextualHeader = function(before, middle, after) {
						if (before) {
							before = before.cell || before.refCell.cell;
						}
						if (after) {
							after = after.cell || after.refCell.cell;
						}
						var align = middle.align,
							leftBorder = "",
							rightBorder = "",
							o = {
								"": "",
								"normal": "|",
								"double": "=",
								"toprule": "^",
								"midrule": "#",
								"bottomrule": "_",
								"hdashline": ":",
								"dottedline": ";"
							};
						middle = middle.cell || middle.refCell.cell;
						if (before) {
							leftBorder = before.getAttribute("data-border-right");
						}
						leftBorder = o[leftBorder || (middle.getAttribute("data-border-left") || "")] || "";
						rightBorder = middle.getAttribute("data-border-right");
						if (after && !rightBorder) {
							rightBorder = after.getAttribute("data-border-left");
						}
						rightBorder = o[rightBorder || ""] || "";
						return leftBorder + align + rightBorder;
					}
					this.caption = function() {
						return {
							caption: $id("caption")
								.value,
							numbered: $id("caption-nb")
								.value == "*",
							label: $id("label")
								.value
						}
					}

					this.getComparableHeader = function(before, middle, after) {
						if (before) {
							before = before.cell || before.refCell.cell;
						}
						if (after) {
							after = after.cell || after.refCell.cell;
						}
						var align = middle.align,
							leftBorder = "",
							rightBorder = "",
							o = {
								"": "",
								"normal": "|",
								"double": "=",
								"toprule": "^",
								"midrule": "#",
								"bottomrule": "_",
								"hdashline": ":",
								"dottedline": ";"
							};
						middle = middle.cell || middle.refCell.cell;
						if (before) {
							leftBorder = "";
						} else {
							leftBorder = middle.getAttribute("data-border-left");
						}
						leftBorder = o[leftBorder || ""] || "";
						rightBorder = middle.getAttribute("data-border-right");
						if (after && !rightBorder) {
							rightBorder = after.getAttribute("data-border-left");
						}
						rightBorder = o[rightBorder || ""] || "";
						return leftBorder + align + rightBorder;
					}
					this.generate = function() {
						this.buildBlacklist();
						var format = $id("format")
							.value;
						this.log="";
						if (format == "latex") {
							$id("c")
								.value = this.generateLaTeX();
						} else {
							this.interpret(format);
						}
						$id("log").value = "Log ("+((new Date()).toLocaleTimeString())+")\n=========\n"+this.log;
					}
					this.generateLaTeX = function(opt) {
						this.packages = {}
						var table = this.element,
							caption = this.caption(),
							booktabs = table.hasAttribute("data-booktabs"),
							rg = this.getMatrixOfCells(),
							border;
						// Determine header
						var header = "",
							headers = [],
							colHeaders = [];
						for (var i = 0; i < rg.length; i++) {
							var cells = rg[i];
							for (var j = 0; j < cells.length; j++) {
								var cell = cells[j];
								if (cell && !cell.ignore) {
									var align = this.getContextualHeader(cells[j - 1], cell, cells[j + 1]);
									if (!headers[j]) {
										headers[j] = {}
									}
									var headernow = headers[j]
									if (!headernow[align]) {
										headernow[align] = 0
									}
									headernow[align]++;
								}
							}
						}
						for (var i = 0; i < headers.length; i++) {
							var max = 0,
								value = "",
								headernow = headers[i];
							for (var j in headernow) {
								if (headernow.hasOwnProperty(j) && headernow[j] > max) {
									max = headernow[j];
									value = j;
								}
							}
							header += value;
							colHeaders.push(value);
						}
						header = this.convertToHeader(header);
						var str = "\\begin{table}[]\n\\centering\n";
						if (caption.caption) {
							str += "\\caption" + (caption.numbered ? "*" : "") + "{" + caption.caption + "}\n";
						}
						if (!caption.numbered && caption.label) {
							str += "\\label{" + caption.label + "}\n";
						}
						str += "\\begin{tabular}{" + header + "}";
						for (var i = 0; i < rg.length; i++) {
							var cells = rg[i];
							if (i === 0 && booktabs) {
								border = " \n\\toprule";
							} else {
								border = this.getBorder(i, rg);
								border = border ? " \n" + border : ""
							}
							if (i !== 0) {
								str += " \\\\" + border
							} else {
								str += border;
							}
							str += "\n"
							for (var j = 0; j < cells.length; j++) {
								header = colHeaders[j] || "l";
								var cell = cells[j];
								if (j !== 0 && cell !== false && !cell.ignore) {
									str += " & ";
								}
								if (cell !== false && !cell.ignore) {
									var contextual = this.getContextualHeader(cells[j - 1], cell, cells[j + 1]),
										comparable = this.getComparableHeader(cells[j - 1], cell, cells[j + 1])
									if (!sameHeader(comparable, header, j) && cell.fullContent.indexOf("\\multicolumn") < 0 && cell.fullContent.length >
										0) {
										str += "\\multicolumn{1}{" + this.convertToHeader(comparable) + "}{" + cell.fullContent + "}";

									} else {
										str += cell.fullContent;
									}
								}
							}
						}
						if (booktabs) {
							str += "\\\\\n\\bottomrule"
						} else {
							border = this.getBorder(rg.length, rg);
							if (border) {
								str += "\\\\\n" + border;
							}
						}
						str += "\n\\end{tabular}\n\\end{table}";
						// Booktabs
						if (/\\(bottomrule)|(toprule)|(midrule)|(cmidrule)|(heavyrulewidth)|(lightrulewidth)/.test(str)) {
							this.packages["booktabs"] = true;
						}
						// arydshln
						if (/\\(cdashline|hdashline)/.test(str)) {
							this.packages["arydshln"] = true;
						}
						// Packages
						var packages = "";
						for (var i in this.packages) {
							if (this.packages.hasOwnProperty(i) && i != "arydshln") {
								packages += "% \\usepackage{" + i + "}\n";
							}
						}
						if (this.packages["arydshln"]) {
							// Compatibility between packages
							packages += "% \\usepackage{arydshln}\n";
						}
						/* Show some message*/
						if(this.element.querySelector("td[data-two-diagonals]")){
							this.message("If you get an '! FP error: Logarithm of negative value!.' error, the content of the bottom part of one of your cells with two diagonals is too long.")
						}
						return (packages ? packages + "\n\n" : "") + str;
					}
					this.hBorder = function(n, callback, matrix) {
						var row = matrix[Math.max(0, (n || 0) - 1)];
						if (!row) {
							return callback.call(this)
						}
						var border = "",
							subBorder = {},
							always = true;
						if (n == 0) {
							for (var i = 0; i < row.length; i++) {
								if (row[i].refCell) {
									always = false;
									continue;
								}
								var cell = row[i].cell,
									bd = cell.getAttribute("data-border-top");
								if (bd) {
									if (!subBorder[bd]) {
										subBorder[bd] = []
									}
									for (var j = 0; j < cell.colSpan; j++) {
										subBorder[bd].push(i);
										i++;
									}
									i--;
									if (border == "") {
										border = bd;
									} else if (border != bd) {
										always = false;
									}
								} else {
									always = false;
								}
							}
						} else {
							var row2 = matrix[n] || [];
							for (var i = 0; i < row.length; i++) {
								var cell = row[i];
								cell = cell.cell || cell.refCell.cell;
								if (cell.parentElement.rowIndex + cell.rowSpan != n) {
									always = false;
									continue;
								}
								var bd = cell.getAttribute("data-border-bottom");
								if (!bd && row2[i]) {
									var cell = row2[i];
									if (cell.cell || (cell.refCell.cell.rowIndex == n + 1)) {
										bd = (cell.cell || cell.refCell.cell)
											.getAttribute("data-border-top");
									}
								}
								if (bd) {
									if (!subBorder[bd]) {
										subBorder[bd] = []
									}
									subBorder[bd].push(i);
									if (border == "") {
										border = bd;
									} else if (border != bd) {
										always = false;
									}
								} else {
									always = false;
								}
							}
						}
						return callback.call(this, always, border, subBorder);
					}
					this.getBorder = function(n, matrix) {
						return this.hBorder(n, function(always, border, subBorder) {
							if (arguments.length == 0) {
								return ""
							}
							if (always) {
								return {
									normal: "\\hline",
									double: "\\hline\\hline",
									toprule: "\\toprule",
									midrule: "\\midrule",
									bottomrule: "\\bottomrule",
									hdashline: "\\hdashline",
									dottedline: "\\hdashline[1pt/1pt]"
								}[border];
							} else {
								border = ""
								var o = {
									normal: "\\cline",
									toprule: "\\cmidrule[\\heavyrulewidth]",
									midrule: "\\cmidrule",
									bottomrule: "\\cmidrule[\\heavyrulewidth]",
									hdashline: "\\cdashline",
									dottedline: "\\cdashline"
								}
								if (!subBorder["double"] || subBorder.toprule || subBorder.midrule || subBorder.bottomrule || true) {
									for (var i in subBorder) {
										if (subBorder.hasOwnProperty(i)) {
											var bd = subBorder[i],
												actu = -2,
												start = -2;
											for (var j = 0; j < bd.length + 1; j++) {
												var nb = (j < bd.length) ? bd[j] : -7;
												if (actu + 1 != nb) {
													if (start >= 0) {
														if (i == "double") {
															// Rare case
															var part = "\\cmidrule{" + (start + 1) + "-" + (actu + 1) + "}";
															border += part + "\\morecmidrule" + part;
														} else {
															border += o[i] + "{" + (start + 1) + "-" + (actu + 1) + "}";
															if (i == "dottedline") {
																border += "[1pt/1pt]";
															}
														}
													}
													start = nb;
												}
												actu = nb
											}
										}
									}
								} else {
									// Another rare case when there's Double subrules. We'll use hhline for this.
									// TODO
								}
							}
							return border;
						}, matrix);
					}
				})()
			window.table = table;
		})();
		window.addEventListener("beforeunload", function(){
			if(window.table){
				localStorage.setItem("table", JSON.stringify(table.exportToJSON()));
				if($id("format")){
					localStorage.setItem("table_format", $id("format").value);
				}
			}
		}, false);
	</script>
	<script type="text/javascript" src="toMarkdown.js">
	</script>
	<script type="text/javascript" src="toTeX.js">
	</script>
</head>

<body>
<div class="container-fluid">
<div class="row">
  <div class="col-md-8">
<div class="alert alert-info" role="alert">
  <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
<span class="glyphicon glyphicon-info-sign"></span> <strong>Preview.</strong> You are now using a preview version of our upcoming Open Source LaTeX table editor. Please report any issues <a href="https://github.com/JDMCreator/LaTeXTableEditor/issues">here</a>.</div>

<div class="row">
<div class="col-md-8">
<div style="height:50px;margin-bottom:10px;"><img src="logo.png" height="50"><span style="
	font-size:30px;
	vertical-align:top;
	display:inline-block;
	line-height:70px;
	padding-left:5px;
">L<span style="    font-size: 75%;
    vertical-align: 0.45ex;
    margin-left: -0.36em;
    margin-right: -0.125em;text-transform:uppercase;">a</span>T<span style="    display: inline-block;
    font-size: 87%;
    line-height: 0;
    text-transform: uppercase;
    vertical-align: -0.45ex;margin-left:-0.15em;margin-right:-0.07em;">e</span>X Complex Table Editor <small style="font-size:14px;">With <a href="https://github.com/JDMCreator/Table.js">Table.js</a></small></span></div>
</div>
<div class="col-md-4 text-right" style="height:50px;"><a href="https://github.com/JDMCreator/LaTeXTableEditor/issues">Comments/Requests/Issues</a>
</div>
</div>
		<nav>

			<!-- Nav tabs -->
			<ul class="nav nav-tabs" role="tablist">
				<li role="presentation" class="active"><a href="#home" aria-controls="home" role="tab" data-toggle="tab">Home</a></li>
				<li role="presentation"><a href="#profile" aria-controls="profile" role="tab" data-toggle="tab">Rows/Columns</a></li>
				<li role="presentation"><a href="#messages" aria-controls="messages" role="tab" data-toggle="tab">Borders</a></li>
				<li role="presentation"><a href="#settings" aria-controls="settings" role="tab" data-toggle="tab">Export settings</a></li>
			</ul>

			<!-- Tab panes -->
			<div class="tab-content">
				<div role="tabpanel" class="tab-pane active" id="home">
					<div class="btn-toolbar" style="margin:3px" role="toolbar" aria-label="...">
						<div class="btn-group" role="group" aria-label="New">
							<span data-target="#myModal" data-toggle="modal"><button type="button" data-toggle="tooltip" title="New table" class="btn btn-default" data-target="#myModal"><span class="glyphicon glyphicon-file"></span></button></span>
						</div><div class="btn-group" role="group" aria-label="New">
							<button type="button" data-toggle="tooltip" title="Save/Export to JSON" class="btn btn-default" onclick="table.saveToJSON()"><span class="glyphicon glyphicon-floppy-disk"></span></button>
						</div>
						<div class="btn-group" role="group" aria-label="...">
							<button type="button" data-toggle="tooltip" title="Edit mode" class="btn btn-default active" id="button-mode-edit" onclick="table.mode(0)"><span class="glyphicon glyphicon-pencil"></span></button>
							<button type="button" data-toggle="tooltip" title="View mode" class="btn btn-default" id="button-mode-view" onclick="table.mode(1)"><span class="glyphicon glyphicon-eye-open"></span></button>
							<button type="button" data-toggle="tooltip" title="Border editor mode" class="btn btn-default" id="button-mode-border" onclick="table.mode(2)"><span class="glyphicon glyphicon-unchecked"></span></button>
						</div>
						<div class="btn-group" role="group" aria-label="...">
							<button type="button" data-toggle="tooltip" title="Bold" class="btn btn-default" onmousedown="event.preventDefault()" onclick="document.execCommand('bold',false,null);return false;"><span class="glyphicon glyphicon-bold"></span></button>
							<button type="button" class="btn btn-default" data-toggle="tooltip" title="Italic" onmousedown="event.preventDefault()" onclick="document.execCommand('italic',false,null);return false;"><span class="glyphicon glyphicon-italic"></span></button>
						</div>
					</div>
				</div>
				<div role="tabpanel" class="tab-pane" id="profile">
					<div class="btn-toolbar" style="margin:3px" role="toolbar" aria-label="...">
						<div class="btn-group" role="group" aria-label="...">
							<button type="button" class="btn btn-default" onclick="table.insertColBefore()" data-toggle="tooltip" title="Insert a column before"><span class="glyphicon glyphicon-arrow-left"></span></button>
							<button type="button" class="btn btn-default" onclick="table.insertColAfter()" data-toggle="tooltip" title="Insert a column after"><span class="glyphicon glyphicon-arrow-right"></span></button>
							<button type="button" class="btn btn-default" onclick="table.insertRowOver()" data-toggle="tooltip" title="Insert a row over"><span class="glyphicon glyphicon-arrow-up"></span></button>
							<button type="button" class="btn btn-default" onclick="table.insertRowUnder()" data-toggle="tooltip" title="Insert a row under"><span class="glyphicon glyphicon-arrow-down"></span></button>
						</div>
						<div class="btn-group" role="group" aria-label="...">
							<button type="button" class="btn btn-default" onclick="table.removeRow()" data-toggle="tooltip" title="Delete rows"><span class="glyphicon glyphicon-remove"></span><span class="glyphicon glyphicon-resize-vertical"></span></button>
							<button type="button" class="btn btn-default" data-toggle="tooltip" onclick="table.removeCol()" title="Delete columns"><span class="glyphicon glyphicon-remove"></span><span class="glyphicon glyphicon-resize-horizontal"></span></button>
						</div>
						<div class="btn-group" role="group" aria-label="...">
							<button type="button" class="btn btn-default" onclick="table.merge()" data-toggle="tooltip" title="Merge cells"><span class="glyphicon glyphicon-resize-small" style="transform:rotate(45deg)"></span></button>
							<button type="button" class="btn btn-default" onclick="table.split()" data-toggle="tooltip" title="Split cells"><span class="glyphicon glyphicon-resize-full" style="transform:rotate(45deg)"></span></button>
						</div>
					</div>
				</div>
				<div role="tabpanel" class="tab-pane" id="messages">
					<div class="btn-toolbar" style="margin:3px" role="toolbar" aria-label="...">
						<div class="btn-group" role="group" aria-label="...">
							<button type="button" class="btn btn-default" onclick="table.setAllBorders()" data-toggle="tooltip" title="Add all borders"><span class="glyphicon glyphicon-unchecked"></span></button>
							<button type="button" class="btn btn-default" onclick="table.removeBorders()" data-toggle="tooltip" title="Remove all borders"><span class="glyphicon glyphicon-remove"></span></button>
						</div>
						<div class="btn-group" role="group" aria-label="...">
							<button type="button" class="btn btn-default" onclick="table.autoBooktabs()" data-toggle="tooltip" title="Automatic Booktabs" id="button-booktabs"><span class="glyphicon glyphicon-book"></span></button>
						</div>
					</div>
				</div>
				<div role="tabpanel" class="tab-pane" id="settings">
					<div style="max-width:500px">
						<div class="form-group">
							<label for="format">Output format</label>
							<select class="form-control" id="format" onchange='$("div[data-option-group]").hide();$("div[data-option-group=\""+this.value+"\"]").show()'>
	<option value="latex">LaTeX</option>
	<option value="plain">Plain TeX</option>
	<option value="md">Markdown</option>
	</select>
						</div>
						<div class="form-group" data-option-group="latex">
							<h4>LaTeX options</h4>
							<div class="input-group">
								<div class="input-group-addon"><span class="glyphicon glyphicon-tags"></span></div>
								<input type="text" class="form-control" id="label" placeholder="Label">
							</div>
							<h4>Packages</h4>
							<div class="row">
								<div class="col-md-6">
									<input type="checkbox" class="input-control" id="blacklist-array" value="array" checked disabled> <label for="blacklist-array">Array</label><br>
									<input type="checkbox" class="input-control" id="blacklist-arydshln" value="arydshln" checked disabled> <label for="blacklist-arydshln">Arydshln</label><br>
									<input type="checkbox" class="input-control" id="blacklist-booktabs" value="booktabs" checked disabled> <label for="blacklist-booktabs">Booktabs</label><br>
									<input type="checkbox" class="input-control" id="blacklist-diagbox" value="diagbox" checked> <label for="blacklist-diagbox">Diagbox</label>
								</div>
								<div class="col-md-6">
									<input type="checkbox" class="input-control" id="blacklist-makecell" value="makecell" checked> <label for="blacklist-makecell">Makecell</label><br>
									<input type="checkbox" class="input-control" id="blacklist-rotating" value="rotating" checked> <label for="blacklist-rotating">Rotating</label><br>
									<input type="checkbox" class="input-control" id="blacklist-slashbox" value="slashbox" checked> <label for="blacklist-slashbox">Slashbox</label><br>
									<input type="checkbox" class="input-control" id="blacklist-tabularx" value="tabularx" checked> <label for="blacklist-tabularx">Tabularx</label>
								</div>
							</div>
						</div>
						<div class="form-group" data-option-group="md" style="display:none;">
							<h4>Markdown options</h4>
							<div class="form-group">
							<label for="md-header">Number of headers' rows</label>
							<input type="number" value="1" min="0" class="form-control" id="md-header">
						</div>
						</div>
						<div class="form-group" data-option-group="plain" style="display:none;">
							<h4>Plain TeX options</h4>
						</div>
					</div>

				</div>
<hr>
		</nav>
		<div class="caption-container">
			<div class="input-group" style="max-width:400px">
				<div class="input-group-addon"><select id="caption-nb">
<option value=""></option>
<option value="*">*</option>
</select></div>
				<input id="caption" class="form-control" placeholder="Caption">
			</div>
		</div>
		<table id="table" style="border-collapse:separate;border-spacing:2px">
		</table>
<div>
<div class="alert alert-info" role="alert" style="display:none;" id="border-editor-info">
  <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
<span class="glyphicon glyphicon-info-sign"></span> You are now using the border editor. Click on any border to activate or desactivate it. You can change the border style on the right panel.</div>
</div>
		<hr><center><button onclick="table.generate()" class="btn btn-default">Generate</button></center><br>
<div class="row">

<div class="col-md-8"><textarea id="c" class="form-control" style="width:100%;height:20%;min-height:300px;">
</textarea>
</div>
<div class="col-md-4">
<textarea id="log" class="form-control" style="width:100%;height:20%;min-height:300px;">Log
=========</textarea>
</div>
</div>
		</div>
  <div class="col-md-4" id="right">
			<div id="borders">
				<h3>Border Editor</h3>
				Type of border : <select id="border" class="form-control">
<option value="normal">[\hline] Default</option>
<option value="double">[\hline\hline] Double line</option>
<optgroup label="Booktabs">
<option value="toprule">[\toprule] Top rule</option>
<option value="midrule">[\midrule] Mid rule</option>
<option value="bottomrule">[\bottomrule] Bottom rule</option>
</optgroup>
<optgroup label="arydshln">
<option value="hdashline">[\hdashline] Dash line</option>
<option value="dottedline">[\hdashline[1pt/1pt]] Dotted line</option>
</optgroup>
</select>
			</div>
			<div id="properties">
				<h3>Cell properties</h3>
						<div class="btn-group" role="group" aria-label="...">
							<button type="button" class="btn btn-default active" id="info_align_left" onclick="table.setAlign('l')"><span class="glyphicon glyphicon-align-left"></span></button>
							<button type="button" class="btn btn-default" id="info_align_center" onclick="table.setAlign('c')"><span class="glyphicon glyphicon-align-center"></span></button>
							<button type="button" class="btn btn-default" id="info_align_right" onclick="table.setAlign('r')"><span class="glyphicon glyphicon-align-right"></span></button>
						</div>
					<h6>Margins</h6>
					Left margin : <input value="3pt" id="info_left_margin" oninput="table.setMargin(true, this.value);" disabled><br> Right margin : <input value="3pt" id="info_right_margin"
					 oninput="table.setMargin(false, this.value);" disabled><br>
					<h6>Effects</h6>
					Diagonal separators : <input type="number" min="0" max="2" value="0" id="info_separators" onchange="table.separators(this.value)"><br>
					<input type="checkbox" id="info_rotated" onchange="table.rotate(this.checked)"> Rotated cell<br>
					<h6>LaTeX Content</h6>
					<textarea id="latex_content" class="form-control"></textarea>
			</div>
		</div>
</div>
</div>
		<div id="popup_new">
			<input id="row" type="number" placeholder="Rows"> x <input id="col" placeholder="Cols" type="number"> <br>
			<button onclick="table.create($id('row').value,$id('col').value);$id('popup_new').style.display='none';">Create</button>
			<button onclick="$id('popup_new').style.display='none';">Cancel</button>
		</div>
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="myModalLabel">Create a new table</h4>
      </div>
      <div class="modal-body">
        <div class="row">
		<div class="col-md-6 text-center">
<center>			<table id="create_table">
			</table></center>

<p>- or -</p>
<div class="form-inline">
  <div class="form-group">
    <input type="number" class="form-control" style="width:50px;" id="col" placeholder="x" min="1">
  </div> x
  <div class="form-group">
    <input type="number" class="form-control" style="width:50px;" id="row" placeholder="y" min="1">
  </div>
  <button type="button" class="btn btn-default" onclick="table.create($id('col').value, $id('row').value);$('#myModal').modal('hide')">Create</button>
</div>
		</div>
		<div class="col-md-6">
			<div class="form-group">
				<select class="form-control">
					<option value="json">JSON</option>
				</select></div>
			<div class="form-group">
				<textarea class="form-control" id="import_value" placeholder="Content of your file to import"></textarea>
			</div><div class="text-center">
			<button type="button" class="btn btn-primary">Import the content of a file</button></div>
		</div>
	</div>
      </div>
    </div>
  </div>
</div>
		<script type="text/javascript">
		$(function(){
			$('nav a')
				.click(function(e) {
					e.preventDefault()
					$(this)
						.tab('show')
				})
			$(function() {
				$('[data-toggle="tooltip"]')
					.tooltip()
			})
			table.load($id('table'));
			var json = localStorage.getItem("table");
			if(json){
				try{
					table.importFromJSON(JSON.parse(json));
				}
				catch(e){
					table.create(4, 4);
				}
			}
			else{
				table.create(4, 4);
			}
			var format = localStorage.getItem("table_format")
			if(format){
				$id("format").value = format;
			}
			function createTableCreater(){
				var table = $id("create_table"),
				frag = document.createDocumentFragment();
				for(var i=0;i<8;i++){
					var tr = document.createElement("tr");
					for(var j=0;j<8;j++){
						var td = document.createElement("td");
						td.dataset.row = i+1;
						td.dataset.col = j+1;
						td.addEventListener("mouseenter", createTableHover, false);
						td.addEventListener("click", function(){
							window.table.create(this.dataset.col, this.dataset.row);
							$("#myModal").modal('hide')
						}, false);
						tr.appendChild(td);
					}
					frag.appendChild(tr);
				}
				table.appendChild(frag);
			}
			function createTableHover(){
				var row = this.dataset.row;
				var col = this.dataset.col;
				var selected = document.querySelectorAll("#create_table td");
				for(var i=0;i<selected.length;i++){
					var elem = selected[i];
					if(elem.dataset.row <= row && elem.dataset.col <= col){
						elem.classList.add("selected");
					}
					else{
						elem.classList.remove("selected");
					}
				}
			}
			createTableCreater();
		});
		</script>
</body>

</html>